# üìã Chat - Referencia R√°pida

## VISUAL R√ÅPIDO

### Estado 1: Sin chat abierto
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                         ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ                                                    ‚îå‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ                                                    ‚îÇüí¨3‚îÇ ‚îÇ ‚Üê Bot√≥n flotante
‚îÇ                                                    ‚îî‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Estado 2: Modal de contactos abierto
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                         ‚îÇ
‚îÇ              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îÇ
‚îÇ              ‚îÇ Mensajes         ‚úï   ‚îÇ                   ‚îÇ
‚îÇ              ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                   ‚îÇ
‚îÇ              ‚îÇ üîç Buscar...         ‚îÇ                   ‚îÇ
‚îÇ              ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                   ‚îÇ
‚îÇ              ‚îÇ üë§ Juan P√©rez  üü¢    ‚îÇ                   ‚îÇ
‚îÇ              ‚îÇ üë§ Mar√≠a Garc√≠a üü¢   ‚îÇ                   ‚îÇ
‚îÇ              ‚îÇ üë§ Carlos L√≥pez üü°   ‚îÇ                   ‚îÇ
‚îÇ              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ
‚îÇ                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Estado 3: Chat abierto
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                         ‚îÇ
‚îÇ              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îÇ
‚îÇ              ‚îÇ Juan P√©rez  üü¢   ‚úï   ‚îÇ                   ‚îÇ
‚îÇ              ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                   ‚îÇ
‚îÇ              ‚îÇ              Hola!   ‚îÇ                   ‚îÇ
‚îÇ              ‚îÇ ¬øC√≥mo est√°s?         ‚îÇ                   ‚îÇ
‚îÇ              ‚îÇ              10:30   ‚îÇ                   ‚îÇ
‚îÇ              ‚îÇ                      ‚îÇ                   ‚îÇ
‚îÇ              ‚îÇ Bien, ¬øy t√∫?         ‚îÇ                   ‚îÇ
‚îÇ              ‚îÇ 10:31                ‚îÇ                   ‚îÇ
‚îÇ              ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                   ‚îÇ
‚îÇ              ‚îÇ üìé Escribe...    ‚û§   ‚îÇ                   ‚îÇ
‚îÇ              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ
‚îÇ                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Estado 4: Notificaci√≥n de mensaje
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üí¨ Juan P√©rez                        ‚îÇ
‚îÇ "Hola, ¬øc√≥mo est√°s?"                 ‚îÇ
‚îÇ Hace 2 segundos                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## COMPONENTES

| Componente | Ubicaci√≥n | Responsabilidad |
|-----------|-----------|-----------------|
| ChatFloatingButton | Fixed bottom-right | Bot√≥n flotante + badge |
| ChatContactsModal | Centered overlay | Lista de usuarios activos |
| ChatWindow | Centered overlay | Ventana de chat |
| ChatInput | Bottom of ChatWindow | Input de mensaje |
| MessagesList | Inside ChatWindow | Lista de mensajes |
| Message | Inside MessagesList | Mensaje individual |
| TypingIndicator | Inside ChatWindow | "Est√° escribiendo..." |
| ChatNotification | Top-right corner | Toast de notificaci√≥n |

---

## EVENTOS SOCKET.IO

### Enviar
```javascript
// Enviar mensaje
socket.emit('message:send', {
  to: userId,
  content: 'Hola!'
});

// Indicar que est√° escribiendo
socket.emit('user:typing', {
  to: userId
});

// Marcar como le√≠do
socket.emit('messages:read', {
  from: userId
});
```

### Recibir
```javascript
// Mensaje recibido
socket.on('message:received', (data) => {
  // { from, content, timestamp }
});

// Usuario escribiendo
socket.on('user:typing', (data) => {
  // { from }
});

// Usuario conectado
socket.on('user:online', (data) => {
  // { userId, name, status }
});

// Usuario desconectado
socket.on('user:offline', (data) => {
  // { userId }
});

// Limpieza nocturna
socket.on('messages:cleared', () => {
  // Limpiar mensajes locales
});
```

---

## ENDPOINTS REST

| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| GET | /api/chat/active-users | Usuarios conectados |
| GET | /api/chat/messages/:userId | Historial del d√≠a |
| POST | /api/chat/messages | Guardar mensaje |
| PUT | /api/chat/messages/:userId/read | Marcar como le√≠do |
| DELETE | /api/chat/messages | Limpiar mensajes |

---

## INDICADORES DE ESTADO

| Icono | Significado | Color |
|-------|------------|-------|
| üü¢ | Online | Verde |
| üü° | Inactivo (>5min) | Amarillo |
| üî¥ | Offline | Rojo |

---

## NOTIFICACIONES

### Badge (Bot√≥n flotante)
- Visible cuando hay mensajes sin leer
- Muestra n√∫mero de mensajes
- Pulse animation
- Se oculta al abrir chat

### Toast (Esquina superior derecha)
- Aparece cuando llega mensaje
- Auto-dismiss en 5 segundos
- Click abre el chat
- Muestra nombre + preview

### Indicador en lista
- Punto rojo junto al nombre
- N√∫mero de mensajes sin leer
- Se actualiza en tiempo real

---

## LIMPIEZA AUTOM√ÅTICA

**Cada noche a las 23:59:**
- ‚ùå DELETE FROM messages WHERE DATE(created_at) < CURRENT_DATE
- ‚úÖ Mantener estado de usuarios
- ‚úÖ Mantener auditor√≠a

---

## FLUJOS PRINCIPALES

### 1. Enviar mensaje
```
Input ‚Üí Enter ‚Üí Socket.emit ‚Üí Backend ‚Üí BD ‚Üí Socket.broadcast ‚Üí Recibir
```

### 2. Recibir mensaje (chat abierto)
```
Socket.on ‚Üí ChatContext ‚Üí MessagesList ‚Üí Auto-scroll ‚Üí Marcar le√≠do
```

### 3. Recibir mensaje (chat cerrado)
```
Socket.on ‚Üí Badge++ ‚Üí Toast ‚Üí Indicador en lista
```

### 4. Abrir chat
```
Click contacto ‚Üí Fetch historial ‚Üí ChatWindow ‚Üí Marcar le√≠do ‚Üí Socket.emit
```

### 5. Escribiendo
```
onChange ‚Üí Socket.emit ‚Üí Backend ‚Üí Socket.broadcast ‚Üí TypingIndicator
```

---

## ESTILOS TAILWIND

```css
/* Bot√≥n flotante */
.chat-button {
  @apply fixed bottom-4 right-4 z-50 w-14 h-14 rounded-full
         bg-blue-500 hover:bg-blue-600 text-white shadow-lg
         flex items-center justify-center transition-all
         duration-200 hover:scale-110;
}

/* Badge */
.chat-badge {
  @apply absolute -top-2 -right-2 bg-red-500 text-white
         rounded-full w-6 h-6 flex items-center justify-center
         text-xs font-bold animate-bounce;
}

/* Modal */
.chat-modal {
  @apply fixed inset-0 bg-black bg-opacity-50 flex items-center
         justify-center z-40;
}

.chat-modal-content {
  @apply bg-white rounded-lg shadow-xl w-80 h-96 flex flex-col
         animate-scale-in;
}

/* Mensaje enviado */
.message-sent {
  @apply bg-blue-500 text-white rounded-lg rounded-br-none
         px-4 py-2 max-w-xs;
}

/* Mensaje recibido */
.message-received {
  @apply bg-gray-200 text-gray-900 rounded-lg rounded-bl-none
         px-4 py-2 max-w-xs;
}

/* Toast */
.chat-toast {
  @apply fixed top-4 right-4 z-50 bg-white rounded-lg shadow-lg
         p-4 max-w-sm cursor-pointer hover:shadow-xl
         transition-shadow animate-slide-in-right;
}
```

---

## ANIMACIONES

```javascript
// tailwind.config.js
animation: {
  'pulse-on-message': 'pulse-message 2s infinite',
  'scale-in': 'scale-in 0.3s ease-out',
  'slide-up': 'slide-up 0.3s ease-out',
  'slide-in-right': 'slide-in-right 0.3s ease-out',
}

keyframes: {
  'pulse-message': {
    '0%, 100%': { transform: 'scale(1)', opacity: '1' },
    '50%': { transform: 'scale(1.1)', opacity: '0.8' },
  },
  'scale-in': {
    '0%': { transform: 'scale(0.95)', opacity: '0' },
    '100%': { transform: 'scale(1)', opacity: '1' },
  },
  'slide-up': {
    '0%': { transform: 'translateY(20px)', opacity: '0' },
    '100%': { transform: 'translateY(0)', opacity: '1' },
  },
  'slide-in-right': {
    '0%': { transform: 'translateX(400px)', opacity: '0' },
    '100%': { transform: 'translateX(0)', opacity: '1' },
  },
}
```

---

## CHECKLIST DE IMPLEMENTACI√ìN

- [ ] Crear tabla `messages` en PostgreSQL
- [ ] Crear tabla `user_sessions` en PostgreSQL
- [ ] Instalar Socket.io en backend
- [ ] Instalar Socket.io-client en frontend
- [ ] Crear ChatContext
- [ ] Crear ChatFloatingButton
- [ ] Crear ChatContactsModal
- [ ] Crear ChatWindow
- [ ] Crear ChatInput
- [ ] Crear MessagesList
- [ ] Crear Message
- [ ] Crear TypingIndicator
- [ ] Crear ChatNotification
- [ ] Crear socketService
- [ ] Crear chatService (API)
- [ ] Crear useChat hook
- [ ] Implementar Socket.io en backend
- [ ] Implementar endpoints REST
- [ ] Implementar limpieza autom√°tica (cron)
- [ ] Agregar animaciones Tailwind
- [ ] Testear flujos principales
- [ ] Testear notificaciones
- [ ] Testear limpieza nocturna

