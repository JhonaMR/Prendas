# ๐ FLUJO DE IMPORTACIรN MASIVA

## Diagrama General

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    DATOS INICIALES                              โ
โ  (CSV, JSON, Excel, Base de datos anterior)                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  CONVERTIDOR CSV โ JSON            โ
        โ  csvToJsonConverter.js             โ
        โ  (Opcional si tienes CSV)          โ
        โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  ARCHIVOS JSON PREPARADOS          โ
        โ  โข referencias.json                โ
        โ  โข fichas-costo.json               โ
        โ  โข pedidos.json                    โ
        โ  โข despachos.json                  โ
        โ  โข recepciones.json                โ
        โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  CREAR CONFIGURACIรN               โ
        โ  migration-config.json             โ
        โ  (Rutas de archivos)               โ
        โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  EJECUTAR MIGRACIรN                โ
        โ  bulkMigration.js                  โ
        โ  o API REST                        โ
        โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  VALIDACIรN Y PROCESAMIENTO        โ
        โ  โข Validar campos                  โ
        โ  โข Verificar integridad            โ
        โ  โข Detectar duplicados             โ
        โ  โข Calcular valores                โ
        โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  INSERTAR EN BASE DE DATOS         โ
        โ  PostgreSQL                        โ
        โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  GENERAR REPORTE                   โ
        โ  migration-report-TIMESTAMP.json   โ
        โ  โข Exitosas                        โ
        โ  โข Fallidas                        โ
        โ  โข Errores                         โ
        โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  SISTEMA LISTO PARA USAR           โ
        โ  Datos cargados e integrados       โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Flujo Detallado por Tipo de Dato

### 1. REFERENCIAS

```
CSV/JSON
   โ
   โผ
Validar:
  โ Cรณdigo รบnico
  โ Descripciรณn presente
  โ Tipos de datos correctos
   โ
   โผ
Verificar:
  โ No existe duplicado
   โ
   โผ
Insertar en:
  product_references
   โ
   โผ
Resultado:
  โ Referencia creada
  โ ID asignado
```

### 2. FICHAS DE COSTO

```
CSV/JSON
   โ
   โผ
Validar:
  โ Referencia existe
  โ Descripciรณn presente
  โ Costos son nรบmeros
   โ
   โผ
Calcular:
  โ Costo total
  โ Precio venta
  โ Rentabilidad
  โ Margen ganancia
   โ
   โผ
Insertar en:
  fichas_costo
   โ
   โผ
Resultado:
  โ Ficha creada
  โ Cรกlculos completados
```

### 3. PEDIDOS

```
CSV/JSON
   โ
   โผ
Validar:
  โ Nรบmero orden รบnico
  โ Cliente existe
  โ Items presentes
   โ
   โผ
Insertar orden en:
  orders
   โ
   โผ
Insertar items en:
  order_items
   โ
   โผ
Resultado:
  โ Orden creada
  โ Items asociados
```

### 4. DESPACHOS

```
CSV/JSON
   โ
   โผ
Validar:
  โ Nรบmero despacho รบnico
  โ Orden existe
  โ Items presentes
   โ
   โผ
Insertar despacho en:
  dispatches
   โ
   โผ
Insertar items en:
  dispatch_items
   โ
   โผ
Resultado:
  โ Despacho creado
  โ Items asociados
```

### 5. RECEPCIONES

```
CSV/JSON
   โ
   โผ
Validar:
  โ Nรบmero recepciรณn รบnico
  โ Items presentes
   โ
   โผ
Insertar recepciรณn en:
  receptions
   โ
   โผ
Insertar items en:
  reception_items
   โ
   โผ
Resultado:
  โ Recepciรณn creada
  โ Items asociados
```

---

## Orden de Importaciรณn (Dependencias)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    REFERENCIAS                              โ
โ  (Base de todo - sin dependencias)                          โ
โโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
        โโโโโโโโโโโโโโดโโโโโโโโโโโโโ
        โ                         โ
        โผ                         โผ
   โโโโโโโโโโโโโโโ          โโโโโโโโโโโโโโโโ
   โ FICHAS      โ          โ CLIENTES     โ
   โ DE COSTO    โ          โ (deben       โ
   โ             โ          โ  existir)    โ
   โโโโโโโโโโโโโโโ          โโโโโโโโฌโโโโโโโโ
                                   โ
                                   โผ
                            โโโโโโโโโโโโโโโโ
                            โ PEDIDOS      โ
                            โ              โ
                            โโโโโโโโฌโโโโโโโโ
                                   โ
                                   โผ
                            โโโโโโโโโโโโโโโโ
                            โ DESPACHOS    โ
                            โ              โ
                            โโโโโโโโโโโโโโโโ

                            โโโโโโโโโโโโโโโโ
                            โ RECEPCIONES  โ
                            โ (independ.)  โ
                            โโโโโโโโโโโโโโโโ
```

---

## Flujo de Validaciรณn

```
DATO INGRESADO
      โ
      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ยฟCampos requeridos presentes?   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      โ
      โโ NO โ โ RECHAZAR
      โ
      โผ Sร
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ยฟTipos de datos correctos?      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      โ
      โโ NO โ โ RECHAZAR
      โ
      โผ Sร
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ยฟReferencias existen?           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      โ
      โโ NO โ โ RECHAZAR
      โ
      โผ Sร
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ยฟDatos duplicados?              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      โ
      โโ Sร โ โ RECHAZAR
      โ
      โผ NO
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ ACEPTAR E INSERTAR           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Flujo de Reportes

```
MIGRACIรN COMPLETADA
      โ
      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ RECOPILAR RESULTADOS             โ
โ โข Exitosas por tipo              โ
โ โข Fallidas por tipo              โ
โ โข Errores detallados             โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ
                   โ
                   โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ GENERAR REPORTE JSON             โ
โ migration-report-TIMESTAMP.json  โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ
                   โ
                   โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ GUARDAR ARCHIVO                  โ
โ Prendas/backend/                 โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ
                   โ
                   โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ MOSTRAR RESUMEN EN CONSOLA       โ
โ โข Total exitosas                 โ
โ โข Total fallidas                 โ
โ โข Detalle por tipo               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Flujo de Errores

```
ERROR DETECTADO
      โ
      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ REGISTRAR ERROR                  โ
โ โข Tipo de dato                   โ
โ โข Identificador                  โ
โ โข Mensaje de error               โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ
                   โ
                   โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ CONTINUAR CON SIGUIENTE REGISTRO โ
โ (No detener migraciรณn)           โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ
                   โ
                   โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ INCLUIR EN REPORTE               โ
โ (Para revisiรณn posterior)        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Flujo de Cรกlculos (Fichas de Costo)

```
DATOS INGRESADOS
      โ
      โโ totalMateriaPrima
      โโ totalManoObra
      โโ totalInsumosDirectos
      โโ totalInsumosIndirectos
      โโ totalProvisiones
      โโ rentabilidad
      โ
      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ CALCULAR COSTO TOTAL             โ
โ = suma de todos los costos       โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ
                   โ
                   โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ CALCULAR PRECIO VENTA            โ
โ = costo ร (1 + rentabilidad%)    โ
โ Ajustado a 900                   โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ
                   โ
                   โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ CALCULAR MARGEN GANANCIA         โ
โ = precio ร 1.35                  โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ
                   โ
                   โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ CALCULAR DESCUENTOS              โ
โ โข 0% descuento                   โ
โ โข 5% descuento                   โ
โ โข 10% descuento                  โ
โ โข 15% descuento                  โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ
                   โ
                   โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ INSERTAR FICHA CON CรLCULOS      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Flujo de Autenticaciรณn

```
REQUEST A API
      โ
      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ยฟToken presente?                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      โ
      โโ NO โ โ 401 UNAUTHORIZED
      โ
      โผ Sร
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ยฟToken vรกlido?                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      โ
      โโ NO โ โ 401 UNAUTHORIZED
      โ
      โผ Sร
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ยฟUsuario es admin?               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      โ
      โโ NO โ โ 403 FORBIDDEN
      โ
      โผ Sร
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ PERMITIR IMPORTACIรN          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Flujo de Integridad Referencial

```
INSERTAR FICHA DE COSTO
      โ
      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ยฟReferencia existe?              โ
โ SELECT FROM product_references   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      โ
      โโ NO โ โ RECHAZAR
      โ       "Referencia no existe"
      โ
      โผ Sร
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ INSERTAR FICHA                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

INSERTAR PEDIDO
      โ
      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ยฟCliente existe?                 โ
โ SELECT FROM clients              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      โ
      โโ NO โ โ RECHAZAR
      โ       "Cliente no existe"
      โ
      โผ Sร
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ INSERTAR PEDIDO               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

INSERTAR DESPACHO
      โ
      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ยฟOrden existe?                   โ
โ SELECT FROM orders               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      โ
      โโ NO โ โ RECHAZAR
      โ       "Orden no existe"
      โ
      โผ Sร
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ INSERTAR DESPACHO             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Resumen Visual

```
ENTRADA                PROCESAMIENTO              SALIDA
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

CSV/JSON โโโโโโโโโโโบ Validaciรณn โโโโโโโโโโโบ BD PostgreSQL
                    Cรกlculos
                    Verificaciรณn
                    Transformaciรณn
                                          โโ Registros insertados
                                          โโ Reporte JSON
                                          โโ Resumen en consola
```

---

**รltima actualizaciรณn:** 25 de Febrero de 2026
