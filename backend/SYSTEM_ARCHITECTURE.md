# ğŸ—ï¸ Arquitectura del Sistema de Backups

## ğŸ“Š Diagrama General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SISTEMA DE BACKUPS                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                          PM2 (Gestor de Procesos)
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚               â”‚               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚ inventario-      â”‚  â”‚ inventario-     â”‚  â”‚
        â”‚ backend          â”‚  â”‚ backup-         â”‚  â”‚
        â”‚ (AplicaciÃ³n)     â”‚  â”‚ scheduler       â”‚  â”‚
        â”‚                  â”‚  â”‚ (Cron 22:00)    â”‚  â”‚
        â”‚ â€¢ Express        â”‚  â”‚                 â”‚  â”‚
        â”‚ â€¢ PostgreSQL     â”‚  â”‚ â€¢ Ejecuta       â”‚  â”‚
        â”‚ â€¢ API REST       â”‚  â”‚   backups       â”‚  â”‚
        â”‚ â€¢ AutenticaciÃ³n  â”‚  â”‚ â€¢ RotaciÃ³n      â”‚  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â”‚                   â”‚           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   PostgreSQL         â”‚              â”‚   Sistema de Archivos
        â”‚   (Base de Datos)    â”‚              â”‚
        â”‚                      â”‚              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ â€¢ Datos de          â”‚              â”‚ â”‚ backups/         â”‚
        â”‚   inventario        â”‚              â”‚ â”‚ â”œâ”€ daily/        â”‚
        â”‚ â€¢ Usuarios          â”‚              â”‚ â”‚ â”‚  â”œâ”€ 2026-02-18 â”‚
        â”‚ â€¢ Transacciones     â”‚              â”‚ â”‚ â”‚  â”œâ”€ 2026-02-17 â”‚
        â”‚                      â”‚              â”‚ â”‚ â”‚  â””â”€ ...        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚ â”œâ”€ weekly/      â”‚
                    â–²                         â”‚ â”‚ â”‚  â”œâ”€ 2026-02-15 â”‚
                    â”‚                         â”‚ â”‚ â”‚  â””â”€ ...        â”‚
                    â”‚                         â”‚ â”‚ â””â”€ monthly/     â”‚
                    â”‚                         â”‚ â”‚    â””â”€ 2026-02-01
                    â”‚                         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                         â”‚
                    â”‚                         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                         â”‚ â”‚ logs/            â”‚
                    â”‚                         â”‚ â”œâ”€ out.log        â”‚
                    â”‚                         â”‚ â”œâ”€ error.log      â”‚
                    â”‚                         â”‚ â”œâ”€ backup-out.log â”‚
                    â”‚                         â”‚ â””â”€ backup-err.log â”‚
                    â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                                  â”‚
        â”‚  pg_dump (Backup)        psql (RestauraciÃ³n)   â”‚
        â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
        â”‚  Crea archivo SQL         Lee archivo SQL       â”‚
        â”‚  Comprime datos           Restaura datos        â”‚
        â”‚  Verifica integridad      Verifica integridad   â”‚
        â”‚                                                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flujo de Backup AutomÃ¡tico

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CADA DÃA A LAS 22:00                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ PM2 Cron Trigger    â”‚
                    â”‚ (0 22 * * *)        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ scheduledBackup.js  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Determinar tipo:    â”‚
                    â”‚ â€¢ Diario (lun-sab)  â”‚
                    â”‚ â€¢ Semanal (dom)     â”‚
                    â”‚ â€¢ Mensual (1er dÃ­a) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Generar nombre:     â”‚
                    â”‚ inventory-backup-   â”‚
                    â”‚ {tipo}-{fecha}.sql  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Ejecutar pg_dump    â”‚
                    â”‚ â€¢ Conectar a BD     â”‚
                    â”‚ â€¢ Exportar datos    â”‚
                    â”‚ â€¢ Crear archivo SQL â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Verificar archivo   â”‚
                    â”‚ â€¢ Existe            â”‚
                    â”‚ â€¢ TamaÃ±o > 0        â”‚
                    â”‚ â€¢ Legible           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Aplicar rotaciÃ³n:   â”‚
                    â”‚ â€¢ Listar backups    â”‚
                    â”‚ â€¢ Contar por tipo   â”‚
                    â”‚ â€¢ Eliminar antiguos â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Registrar logs:     â”‚
                    â”‚ â€¢ Tipo de backup    â”‚
                    â”‚ â€¢ TamaÃ±o            â”‚
                    â”‚ â€¢ Archivos borrados â”‚
                    â”‚ â€¢ EstadÃ­sticas      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ âœ… Backup Completo  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flujo de RestauraciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              USUARIO SOLICITA RESTAURACIÃ“N                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ POST /api/backups/  â”‚
                    â”‚ restore             â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Validar:            â”‚
                    â”‚ â€¢ AutenticaciÃ³n     â”‚
                    â”‚ â€¢ Rol admin         â”‚
                    â”‚ â€¢ Archivo existe    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Crear backup de     â”‚
                    â”‚ seguridad del       â”‚
                    â”‚ estado actual       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Ejecutar psql       â”‚
                    â”‚ < backup.sql        â”‚
                    â”‚ â€¢ Conectar a BD     â”‚
                    â”‚ â€¢ Restaurar datos   â”‚
                    â”‚ â€¢ Verificar         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Verificar           â”‚
                    â”‚ integridad:         â”‚
                    â”‚ â€¢ Tablas existen    â”‚
                    â”‚ â€¢ Datos completos   â”‚
                    â”‚ â€¢ Relaciones OK     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Retornar resultado  â”‚
                    â”‚ â€¢ Ã‰xito/Error       â”‚
                    â”‚ â€¢ Backup de seg.    â”‚
                    â”‚ â€¢ Timestamp         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ âœ… RestauraciÃ³n OK  â”‚
                    â”‚ (Recargar app)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Estructura de Datos

### Backup File
```
inventory-backup-{tipo}-{fecha}-{hora}.sql
â”‚
â”œâ”€ tipo: daily | weekly | monthly
â”œâ”€ fecha: YYYY-MM-DD
â”œâ”€ hora: HH-MM-SS
â””â”€ contenido: SQL dump de PostgreSQL
```

### EstadÃ­sticas
```json
{
  "totalBackups": 11,
  "totalSizeInMB": "550.25",
  "byType": {
    "daily": {
      "count": 7,
      "sizeInMB": "350.00"
    },
    "weekly": {
      "count": 3,
      "sizeInMB": "150.00"
    },
    "monthly": {
      "count": 1,
      "sizeInMB": "50.25"
    }
  }
}
```

---

## ğŸ” Capas de Seguridad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SOLICITUD API                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Capa 1: HTTPS       â”‚
                    â”‚ (EncriptaciÃ³n)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Capa 2: JWT Token   â”‚
                    â”‚ (AutenticaciÃ³n)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Capa 3: Rol Admin   â”‚
                    â”‚ (AutorizaciÃ³n)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Capa 4: ValidaciÃ³n  â”‚
                    â”‚ (Datos)             â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Capa 5: Backup Seg. â”‚
                    â”‚ (Antes de restaurar)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ âœ… Acceso Permitido â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Ãrbol de Directorios

```
backend/
â”‚
â”œâ”€â”€ ğŸ“„ ecosystem.config.js
â”‚   â””â”€ ConfiguraciÃ³n de PM2
â”‚
â”œâ”€â”€ ğŸ“„ BACKUP_SYSTEM.md
â”‚   â””â”€ DocumentaciÃ³n completa
â”‚
â”œâ”€â”€ ğŸ“ backups/
â”‚   â”œâ”€â”€ ğŸ“ daily/
â”‚   â”‚   â”œâ”€â”€ inventory-backup-daily-2026-02-18-22-00-15.sql
â”‚   â”‚   â”œâ”€â”€ inventory-backup-daily-2026-02-17-22-00-12.sql
â”‚   â”‚   â””â”€â”€ ... (mÃ¡ximo 7)
â”‚   â”œâ”€â”€ ğŸ“ weekly/
â”‚   â”‚   â”œâ”€â”€ inventory-backup-weekly-2026-02-15-22-00-08.sql
â”‚   â”‚   â””â”€â”€ ... (mÃ¡ximo 4)
â”‚   â””â”€â”€ ğŸ“ monthly/
â”‚       â”œâ”€â”€ inventory-backup-monthly-2026-02-01-22-00-05.sql
â”‚       â””â”€â”€ ... (mÃ¡ximo 3)
â”‚
â”œâ”€â”€ ğŸ“ logs/
â”‚   â”œâ”€â”€ out.log
â”‚   â”œâ”€â”€ error.log
â”‚   â”œâ”€â”€ backup-out.log
â”‚   â””â”€â”€ backup-error.log
â”‚
â””â”€â”€ ğŸ“ src/
    â”œâ”€â”€ ğŸ“ services/
    â”‚   â”œâ”€â”€ BackupRotationService.js
    â”‚   â””â”€â”€ BackupExecutionService.js
    â”œâ”€â”€ ğŸ“ controllers/
    â”‚   â””â”€â”€ backupController.js
    â”œâ”€â”€ ğŸ“ routes/
    â”‚   â”œâ”€â”€ index.js (incluye backupRoutes)
    â”‚   â””â”€â”€ backupRoutes.js
    â””â”€â”€ ğŸ“ scripts/
        â”œâ”€â”€ scheduledBackup.js
        â””â”€â”€ testBackupSystem.js
```

---

## ğŸ”„ Ciclo de Vida de un Backup

```
CREACIÃ“N
   â”‚
   â”œâ”€ DÃ­a 1: Backup Diario (50 MB)
   â”œâ”€ DÃ­a 2: Backup Diario (50 MB)
   â”œâ”€ DÃ­a 3: Backup Diario (50 MB)
   â”œâ”€ DÃ­a 4: Backup Diario (50 MB)
   â”œâ”€ DÃ­a 5: Backup Diario (50 MB)
   â”œâ”€ DÃ­a 6: Backup Diario (50 MB)
   â”œâ”€ DÃ­a 7: Backup Diario (50 MB)
   â”œâ”€ DÃ­a 8: Backup Diario (50 MB)
   â”‚         â†“ Se elimina DÃ­a 1
   â”‚
   â”œâ”€ Domingo 1: Backup Semanal (50 MB)
   â”œâ”€ Domingo 2: Backup Semanal (50 MB)
   â”œâ”€ Domingo 3: Backup Semanal (50 MB)
   â”œâ”€ Domingo 4: Backup Semanal (50 MB)
   â”œâ”€ Domingo 5: Backup Semanal (50 MB)
   â”‚             â†“ Se elimina Domingo 1
   â”‚
   â”œâ”€ 1 Febrero: Backup Mensual (50 MB)
   â”œâ”€ 1 Marzo: Backup Mensual (50 MB)
   â”œâ”€ 1 Abril: Backup Mensual (50 MB)
   â”œâ”€ 1 Mayo: Backup Mensual (50 MB)
   â”‚           â†“ Se elimina 1 Febrero
   â”‚
   â””â”€ ELIMINACIÃ“N (despuÃ©s de retenciÃ³n)
```

---

## ğŸ“ˆ Escalabilidad

```
Backups por DÃ­a:     1
Backups por Semana:  2 (1 diario + 1 semanal)
Backups por Mes:     ~9 (7 diarios + 1 semanal + 1 mensual)
Backups por AÃ±o:     ~110 (pero solo 11 almacenados)

Almacenamiento:
- MÃ­nimo: 350 MB (7 diarios)
- MÃ¡ximo: 700 MB (7 diarios + 4 semanales + 3 mensuales)
- Promedio: 550 MB

Tiempo de Backup:
- PequeÃ±a BD (50 MB): ~3-5 segundos
- Mediana BD (500 MB): ~30-60 segundos
- Grande BD (5 GB): ~5-10 minutos
```

---

## ğŸ¯ Componentes Principales

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   COMPONENTES DEL SISTEMA                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. BackupRotationService
   â”œâ”€ getBackupType()
   â”œâ”€ generateBackupFilename()
   â”œâ”€ getBackupsByType()
   â”œâ”€ rotateBackups()
   â”œâ”€ getStorageStats()
   â””â”€ listAllBackups()

2. BackupExecutionService
   â”œâ”€ executeBackup()
   â”œâ”€ restoreBackup()
   â””â”€ getBackupInfo()

3. backupController
   â”œâ”€ listBackups()
   â”œâ”€ getBackupStats()
   â”œâ”€ restoreBackup()
   â”œâ”€ getBackupInfo()
   â””â”€ executeManualBackup()

4. backupRoutes
   â”œâ”€ GET /
   â”œâ”€ GET /stats
   â”œâ”€ GET /:filename
   â”œâ”€ POST /manual
   â””â”€ POST /restore

5. scheduledBackup.js
   â””â”€ runBackup() [Ejecutado por PM2 a las 22:00]
```

---

**Arquitectura completa y escalable para un sistema de backups empresarial.**
